<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>mpblu: Combine MPBArray construction and factorization · MultiPrecisionArrays.jl</title><meta name="title" content="mpblu: Combine MPBArray construction and factorization · MultiPrecisionArrays.jl"/><meta property="og:title" content="mpblu: Combine MPBArray construction and factorization · MultiPrecisionArrays.jl"/><meta property="twitter:title" content="mpblu: Combine MPBArray construction and factorization · MultiPrecisionArrays.jl"/><meta name="description" content="Documentation for MultiPrecisionArrays.jl."/><meta property="og:description" content="Documentation for MultiPrecisionArrays.jl."/><meta property="twitter:description" content="Documentation for MultiPrecisionArrays.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MultiPrecisionArrays.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Half Precision and Krylov-IR</span><ul><li><a class="tocitem" href="../../Half_1/">Half Precision and Krylov-IR</a></li></ul></li><li><span class="tocitem">More than you want to know</span><ul><li><a class="tocitem" href="../../Details/Termination/">Terminating the while loop</a></li><li><a class="tocitem" href="../../Details/N2Work/">Is O(N^2) work negligible?</a></li><li><a class="tocitem" href="../../Details/Interprecision_1/">Interprecision Transfers: Part I</a></li><li><a class="tocitem" href="../../Details/Extended/">Evaluating residuals in higher precision</a></li></ul></li><li><span class="tocitem">MPArray Constructors</span><ul><li><a class="tocitem" href="../MPArray/">MPArray: constructor</a></li><li><a class="tocitem" href="../MPGArray/">MPGArray: constructor</a></li><li><a class="tocitem" href="../MPBArray/">MPBArray: constructor</a></li></ul></li><li><span class="tocitem">Factorizations</span><ul><li><a class="tocitem" href="../hlu!/">hlu!: Get LU to perform reasonably well for Float16</a></li><li><a class="tocitem" href="../mplu!/">mplu!: Simple MPArray factorization</a></li><li><a class="tocitem" href="../mplu/">mplu: Combine MPArray construction and factorization</a></li><li><a class="tocitem" href="../mpglu!/">mpglu!: Factor a MPGArray and set it up for GMRES by allocating room for Krylov vectors etc</a></li><li><a class="tocitem" href="../mpglu/">mpglu: Combine MPGArray construction and factorization</a></li><li><a class="tocitem" href="../mpblu!/">mpblu!: Factor a MPBArray and set it up for BiCGSTAB by allocating room for a few vectors</a></li><li class="is-active"><a class="tocitem" href>mpblu: Combine MPBArray construction and factorization</a></li></ul></li><li><span class="tocitem">Iteration Statistics</span><ul><li><a class="tocitem" href="../../Details/Stats/">Harvesting Iteration Statistics</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../mpgeslir/">mpgeslir: IR solver</a></li><li><a class="tocitem" href="../mpkrir/">mpkrir: Krylov-IR solver</a></li></ul></li><li><span class="tocitem">Termination</span><ul><li><a class="tocitem" href="../update_parms/">update_parms: Adjust termination criteria for while loop in IR</a></li></ul></li><li><span class="tocitem">References</span><ul><li><a class="tocitem" href="../../References/">References</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Factorizations</a></li><li class="is-active"><a href>mpblu: Combine MPBArray construction and factorization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>mpblu: Combine MPBArray construction and factorization</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ctkelley/MultiPrecisionArrays.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ctkelley/MultiPrecisionArrays.jl/blob/main/docs/src/functions/mpblu.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="mpblu:-Combine-MPBArray-construction-and-factorization"><a class="docs-heading-anchor" href="#mpblu:-Combine-MPBArray-construction-and-factorization">mpblu: Combine MPBArray construction and factorization</a><a id="mpblu:-Combine-MPBArray-construction-and-factorization-1"></a><a class="docs-heading-anchor-permalink" href="#mpblu:-Combine-MPBArray-construction-and-factorization" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiPrecisionArrays.mpblu-Union{Tuple{AbstractMatrix{TW}}, Tuple{TW}} where TW&lt;:Real" href="#MultiPrecisionArrays.mpblu-Union{Tuple{AbstractMatrix{TW}}, Tuple{TW}} where TW&lt;:Real"><code>MultiPrecisionArrays.mpblu</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>mpblu(A::AbstractArray{TW,2}; TF=Float32, TR=nothing, i           residterm=residtermdefault) where TW &lt;: Real</p><p>Combines the constructor of the multiprecision BiCGSTAB-ready array with the factorization.</p><p>Step 1: build the MPBArray</p><p>Step 2: Call mpblu! to build the factorization object</p><p>Step 3: Allocate the internal vectors that BiCGSTAB needs.</p><p>IR-Krylov methods were designed as saviors of half precision. So, as we did with mpglu, we will run through some examples. The difference here is that there is no Kylov basis to store. </p><p>Here&#39;s the example from <code>mpglu</code></p><p>You may not get exactly the same results for this example on different hardware, BLAS, versions of Julia or this package.  I am still playing with the termination criteria and the iteration count could grow or shrink as I do that.</p><p>#Example</p><pre><code class="language-julia-repl hljs">julia&gt; using MultiPrecisionArrays

julia&gt; using MultiPrecisionArrays.Examples

julia&gt; N=4096; alpha=799.0; AD = I - alpha*Gmat(N); A = Float32.(AD);

# Try vanilla IR with TF=Float16

julia&gt; xe=ones(Float32,N); b=A*xe; AF=mplu(A);

julia&gt; mout=\(AF, b; reporting=true);

julia&gt; mout.rhist
5-element Vector{Float64}:
 9.88750e+01
 3.92435e+00
 3.34373e-01
 2.02045e-01
 2.24720e-01

# That does not look like convergence. What about TR=Float64?

julia&gt; BF=mplu(A; TR=Float64);

julia&gt; mout2=\(BF, b; reporting=true);

julia&gt; mout2.rhist
5-element Vector{Float64}:
 9.88750e+01
 3.92614e+00
 3.34301e-01
 2.01975e-01
 2.24576e-01

# This is where we were in the docs for ```mpglu```. I&#39;ll try IR-BiCGSTAB

julia&gt; GF=mpblu(A; TR=Float64);

julia&gt; mout3=\(GF, b; reporting=true);

julia&gt; mout3.rhist
4-element Vector{Float64}:
 9.88750e+01
 2.16858e-11
 8.38440e-13
 8.81073e-13

# That is very different from IR-GMRES. The reason is that there is no
# limit on Krylov iterations because there is no Krylov subspace.
# So, the linear work produces a large reduction in the residual in
# the first iterate.

# Of course, we got it right and solved the promoted problem.

julia&gt; xp=Float64.(A)\b; norm(xp-mout3.sol,Inf)
1.63376e-11</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ctkelley/MultiPrecisionArrays.jl/blob/36a7baf4b1102d1936f42dd0b6e1daca1479423e/src/Factorizations/mpblu!.jl#L73-L157">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mpblu!/">« mpblu!: Factor a MPBArray and set it up for BiCGSTAB by allocating room for a few vectors</a><a class="docs-footer-nextpage" href="../../Details/Stats/">Harvesting Iteration Statistics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Tuesday 20 May 2025 19:18">Tuesday 20 May 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
